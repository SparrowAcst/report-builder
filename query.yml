- query:
    - from: harvest1
    - match:
        label: updated by
        operation: "!="
        value: import utils
    - dateTrunc:
        label: updated at
        unit: day
        binSize: 1
    - out: A

- aggregate:
    - histogram:
        from: A
        label: updated at
        into: dates
    
    # - count:
    #     from: A
    #     transform: value => value.count
    #     into: dataset.length
    
    - timeline:
        from: A
        date: updated at
        groupBy: updated by
        into: activity   
    
    - set:
        from: A
        transform: value => uniqBy(value.map(d => d["Examination ID"]))
        into: table

    - value:
        transform: () => moment(new Date()).format("YYYY-MM-DD")
        into: now    

- publish:
    - section:
        align: justify-center
        columns:
          - column:
              width: 4
              widgets:

                - bar-chart:
                    title: A
                    from: dates[updated at]
                    asCategory: value
                    asValue: count
                    height: 50  
                    vertical: false
                    style: 'border: 1px solid red; margin: 10px; padding: 10px;'

                - pie-chart:
                    from: dates[updated at]
                    asCategory: value
                    asValue: count
                    height: 350
                    style: 'border: 1px solid;'  
                  


                - bar-chart:
                    title: B
                    from: dates[updated at]
                    asCategory: value
                    asValue: count
                    height: 350
                    vertical: true

    

- purge: {}


# - query:
    
#     - from: app-grant
    
#     - match:
#         label: role
#         operation: ==
#         value: "1st expert"
    
#     - project:
#         - namedAs
#     - sort:
#         namedAs: 1    
    
#     - out: A

# - aggregate:
#     - set:
#         from: A
#         transform: value => value.map( v => v.namedAs).join(", ")
#         into: workers    

# - publish:
#     - section:
#         align: justify-center
#         columns:
#           - column:
#               width: 12
#               widgets:
#                 - markdown:
#                     from: a
#                     content: '**1st Experts**: {{workers}}'


# - purge: {}    


# - query:
#     - from: harvest1
    
#     - match:
#         label: labelingId
#         operation: ==
#         value: e77d5a85-99ae-4238-9e62-5d75c1ee123c
    
#     - dateTrunc:
#         label: date
#         unit: day
#         binSize: 2            
#     - sort:
#         date: 1  
#     - out: A 

# - aggregate:

#     - histogram:
#         from: A
#         label: 
#           - todo
#           - assigned to
#         transform: value => value  
#         into: hist

#     - count:
#         from: A
#         transform: value => value  
#         into: count

#     - set:
#         from: app-grants
#         transform: value => value  
#         into: tableData 

#     - timeline:
#         from: A
#         date: date
#         groupBy:
#           - todo
#         transform: value => value  
#         into: timelineData        

# - purge: {}
